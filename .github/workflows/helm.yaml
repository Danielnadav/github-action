name: Helm Deploy

on: [push]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check out code
      uses: actions/checkout@v2
      
    - name: Set up kubectl
      run: |
        mkdir -p $HOME/.kube
        echo "$KUBE_CONFIG_DATA" > $HOME/.kube/config
        chmod 600 $HOME/.kube/config
        kubectl config use-context $HOME/.kube/config
    
    - name: Install Helm
      run: |
        curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
        chmod +x get_helm.sh
        ./get_helm.sh
    
    - name: Run Helm Install
      run: |
        helm repo add stable https://charts.helm.sh/stable
        helm install my-release stable/nginx-ingress
